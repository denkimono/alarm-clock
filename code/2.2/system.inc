; Copyright (c) 2007 Mark Longstaff-Tyrrell All Rights Reserved.
; DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
;
; This code is free software; you can redistribute it and/or modify it
; under the terms of the GNU General Public License version 3 only, as
; published by the Free Software Foundation.
;
;  This code is distributed in the hope that it will be useful,
;  but WITHOUT ANY WARRANTY; without even the implied warranty of
;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;  GNU General Public License for more details.
;
;  You should have received a copy of the GNU General Public License
;  along with this work.  If not, see <http://www.gnu.org/licenses/>.

; crystal oscillator on, WDT off, copy protection on, power on timer enabled
	__CONFIG	_XT_OSC & _WDT_OFF & _CP_ALL & _PWRTE_ON & _BODEN_OFF

; SELECT PRODUCTION OR PROTOTYPE HARDWARE
IFNDEF SYSTEM_VERSION

PROTOTYPE_1	EQU	0X00	; 1ST VERSION ON VEROBOARD
PROTOTYPE_2	EQU	0X01	; 1ST PCB PROTOTYPE (VERSION A)
PRODUCTION	EQU	0X02	; PRODUCTION VERSION (REV 1)

; SELECT HARDWARE PLATFORM HERE
;SYSTEM_VERSION	EQU	PROTOTYPE_1 ; veroboard
;SYSTEM_VERSION	EQU	PROTOTYPE_2 ; prototype pcb
SYSTEM_VERSION	EQU	PRODUCTION  ; production version rev 1 and above

; SPECIAL BUILDS
;NORMAL	EQU	0X01
RALLY	EQU	0X14

; DEFINE S/W VERSION HERE
SOFTWARE_VERSION_HI	EQU	D'2'
SOFTWARE_VERSION_LO	EQU	D'0'

ENDIF

; RAM variables (BANK 0)

; display memory
DIG1	EQU		0X20
DIG2	EQU		0X21
DIG3	EQU		0X22
DIG4	EQU		0X23
DIG5	EQU		0X24
DIG6	EQU		0X25
DIG7	EQU		0X26

; ISR context saving
STATUS_TEMP	EQU	0X27
W_TEMP		EQU	0X28
;

; pause variables
PTEMP1	EQU		0X29
PTEMP2	EQU		0X30

; temp variables
TEMP1	EQU		0X31

; countdowm timer values
HOUR	EQU		0x32
MIN		EQU		0x33
SEC		EQU		0x34
HUN		EQU		0x35

; clock values
C_HOUR	EQU		0x36
C_MIN	EQU		0x37
C_SEC	EQU		0x38

; alarm values
A_HOUR	EQU		0x39
A_MIN	EQU		0x3A

; multiplexer variables
MPX_DIGIT	EQU	0x3B

; GENERAL PURPOSE
COUNTER	EQU 0X3C

; INTERRUPT VARIABLES
ITEMP1	EQU	0X3D
ICOUNTER	EQU 0X3E

SUBTICKS	EQU 0X3F
ISECOND		EQU 0X40
IHSECOND	EQU 0X41
ITSECOND	EQU 0X42

; KEYBOARD
KEY_COL	EQU	0X43
CURRENT_KEY	EQU	0X44
TEMP_KEY	EQU	0X45
LAST_KEY	EQU	0X46

; MODE STATE VARIABLE FOR VARIOUS FUNCTIONS
MODE	EQU 0X47	; MAIN SYSTEM MODE
CD_MODE	EQU 0X48	; COUNTDOWN MODE
TM_MODE	EQU 0X49	; TIMER MODE
AL_MODE	EQU 0X4A	; ALARM MODE

; MATHS VARIABLES
D_MOD	EQU	0X4B
D_NUM	EQU	0X4C
D_DIV	EQU	0X4D

CURSOR	EQU	0X4E
KEY_COUNT	EQU	0X4F

; VARIOUS TICKS
TICKS	EQU	0X50

IN_KEY	EQU	0X51

; temp variables
TEMP2	EQU		0X52

INT_CORRECT	EQU		0X53
INT_CURSOR	EQU		0X54

BRIGHTNESS	EQU		0X55
FRAME_COUNT	EQU		0X56

BUZZER_COUNT	EQU		0X57

; SAVE THIS DURING INTERRUPTS
IFSR	EQU	0X58
ID_MOD	EQU	0X59
ID_NUM	EQU	0X5A
ID_DIV	EQU	0X5B

SNOOZE_MINS	EQU	0X5C
MORE_FLAGS	EQU	0X5D

LP_MODE		EQU	0X5E

MPX_CYCLES	EQU 0x5F

; *********
; CONSTANTS
; *********

; MORE_FLAGS FLAGS
TICK_EN		EQU	0	; COUNTDOWN TICKS ENABLED
TONE_TOG	EQU	1	; 
ALARM_TONE	EQU	2	; f OR f/2
TICKING		EQU	3	; IS THIS A TICK SOUND OR NORMAL SOUND
UP_DOWN		EQU	4	; ARE WE COUNTING DOWN (0) OR UP (1)?
MIL_MODE	EQU	5	; 24 hour clock display
FREEZE		EQU	6	; freeze display
TIMER_RUN	EQU	7	; HAS TIMER BEEN RUN SINCE RESET (CAN WE ACCEPT NEW TIME FROM KB?)

; TIMING CONSTANTS
SUBTICK_COUNT EQU D'20'
TSECOND_COUNT EQU D'10'
HSECOND_COUNT EQU D'5'
SECOUND_COUNT EQU D'2'


MODE_KEY	EQU 0X0F
SET_KEY		EQU 0X0E

; MODES
MODE_CD	EQU	0X00
MODE_TM	EQU	0X01
MODE_AL	EQU	0X02
MAX_MODE	EQU	MODE_AL + 0X01

; COUNTDOWN MODE
CD_PAUSED		EQU	0X00
CD_RUNNING		EQU	0X01

; IN TIMER MODE
TM_TIME			EQU	0X00
TM_SET			EQU	0X01

; TIME DISPLAY MODE
TM_DATETIME		EQU	0X01
TM_ALTDATETIME	EQU	0X02
TM_DATE			EQU	0X03

;TM_ALARM_ON		EQU	0X04

; IN ALARM MODE
AL_SHOW			EQU	0X00
AL_SET			EQU	0X01
AL_VER			EQU	0X02

LONG_KEY	EQU	0X04

; SPECIAL LED CHARACTERS
BLANK		EQU 0X0A
COLONS		EQU 0X0B
DOTS		EQU 0X0C
DASH		EQU	0X0D
UNDERSCORE	EQU 0X0E
BARS  		EQU	0X0F
EQUALS  	EQU	0X10
LETTER_T	EQU	0X11
LETTER_E	EQU	0X12
SET_COLON	EQU	0X13
LETTER_A	EQU	0X14
LETTER_L	EQU	0X15
LETTER_N	EQU	0X16
LETTER_P	EQU	0X17
LETTER_R	EQU	0X18
VER_COLON	EQU	0X19
COLON_12H	EQU	0X1A
COLON_TOP	EQU	0X1B
COLON_BOT	EQU	0X1C


; TICKS BITS (AND OTHER FLAGS)
TICKS_DUMMY		EQU	0
TICKS_HSECOND	EQU	1
TM_ALARM_ON		EQU 2	; CLOCK ALARM IS SOUNDING
CD_ALARM_ON		EQU 3	; COUNTDOWN ALARM IS SOUNDING
KEYBEEP			EQU 4	; KEYBEEP
BUZZER_PHASE	EQU 5
DISPLAY_INT		EQU	6	; INDICATE BACKGROUND DISPLAY INTERRUPT HAS OCCURRED
TICKS_BUZZER	EQU	7


SNOOZE_DURATION	EQU D'10'; 10 MINS - 1 MIN MORE SLEEP THAN OTHER ALARM CLOCKS!


; pin definitions
DIGIT1	EQU		0	;PORT A o/p
DIGIT2	EQU		1
DIGIT3	EQU		2
DIGIT4	EQU		3
DIGIT5	EQU		4
DIGIT6	EQU		5

BUZZER	EQU		0	;PORT B i/p - o/p
KB_COL3	EQU		1
KB_COL2	EQU		2
KB_COL1	EQU		3
KB_ROW4	EQU		4
KB_ROW3	EQU		5
KB_ROW2	EQU		6
KB_ROW1	EQU		7

SEG_A	EQU		0	;PORT C i/p
SEG_B	EQU		1
SEG_C	EQU		2
SEG_D	EQU		3
SEG_E	EQU		4
SEG_F	EQU		5
SEG_G	EQU		6
DIGIT7	EQU		7
